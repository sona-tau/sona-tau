<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<meta property="og:title" content="Diego's blog!">
<meta property="og:description" content="Diego's website for publishing projects, blogs and more!">
<meta property="og:image" content="https://diego-est.dev/banner.png">
<meta property="og:url" content="https://diego-est.dev">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Diego's blog!">
<meta name="twitter:description" content="Diego's website for publishing projects, blogs and more!">
<meta name="twitter:image" content="https://diego-est.dev/banner.png">
<meta name="twitter:site" content="@SunglYou">
<meta content="#43B581" data-react-helmet="true" name="theme-color" />
<title>C&#43;&#43; Prelude | My website!</title>

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=IBM Plex Mono" type="text/css" media="all" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Fira Mono" type="text/css" media="all" />


<style>
body {
    font-family: 'IBM Plex Mono';
}
 code {
     font-family: 'Fira Mono'; 
 }
</style>

      <link rel="stylesheet" href="/css/main.min.91dd2b01122c5e0b3262af339f7d5c5712d4e2198424eca2ef88daa4a341230f.css" integrity="sha256-kd0rARIsXgsyYq8zn31cVxLU4hmEJOyi74japKNBIw8=" crossorigin="anonymous">
        <link rel="stylesheet" href="/css/syntax.min.14e61992514fff6118d2aa5f5dacc3f9b109f0f8b2307d7910852fa23f81a4c2.css" />


      <script src="/js/main.fcccc39f84221f52cc1191a30592cfbb512136298d74042d4b42b2337cd1d7ac.js" integrity="sha256-/MzDn4QiH1LMEZGjBZLPu1EhNimNdAQtS0KyM3zR16w=" crossorigin="anonymous"></script>


</head>
<body>
<table class="header">
  <tr>
    <td colspan="2" rowspan="2" class="width-auto">
        <h1 class="title">C&#43;&#43; Prelude</h1>
        <span class="subtitle">Sensible defaults for a very irrational language.</span>
    </td>
    <th>Version</th>
    <td class="width-min">0.1.0</td>
  </tr>
  <tr>
    <th>Updated</th>
    <td class="width-min"><time style="white-space: pre;">2024-01-08</time></td>
  </tr>
  <tr>
    <th class="width-min">Author</th><td class="width-auto"><a href="mailto:daestrada@pm.me"><cite>diego</cite></a></td>
    <th class="width-min">License</th>
    <td>MIT</td>
  </tr>
</table>
<label class="debug-toggle-label">
    <input type="checkbox" class="debug-toggle" />
    Debug mode
</label>
  <main>
    


  <p>Modern C++ makes me sad when I look at it. So this is my attempt to change
several of the defaults we use to code in C++. Additionally, several features
that are missing in the language (but enabled through obscure compiler macros
and directives) are enabled.</p>
<h1 id="project-pagehttpscodebergorgdiego-estcpp-prelude"><a href="https://codeberg.org/diego-est/cpp-prelude">project page</a></h1>
<h2 id="includes">Includes</h2>
<p>Several containers and algorithms can be included using the <code>CONTAINERS</code> or
<code>ALGORITHMS</code> or <code>IO</code> directive. I use these very frequently, others might not. For that
reason they are opt-in. To enable them define the the containers or algorithms
directive <strong>before</strong> including the header.</p>
<p>Like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#define CONTAINERS
</span></span></span><span class="line"><span class="cl"><span class="cp">#define ALGORITHMS
</span></span></span><span class="line"><span class="cl"><span class="cp">#define IO
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;prelude.hpp&#34;</span><span class="cp">
</span></span></span></code></pre></div><p>The following containers are included:</p>
<ul>
<li>unordered_map</li>
<li>unordered_set</li>
<li>queue</li>
<li>stack</li>
<li>list</li>
<li>span</li>
</ul>
<p>The following algorithms are included:</p>
<ul>
<li>algorithm</li>
<li>ranges</li>
<li>numeric</li>
</ul>
<p>The following io headers are included:</p>
<ul>
<li>format</li>
<li>fstream</li>
</ul>
<p>The following headers are included by default:</p>
<ul>
<li>cstdint</li>
<li>limits.h</li>
<li>iostream</li>
</ul>
<h2 id="types">Types</h2>
<p>A mix of the naming scheme in Rust and HolyC is very aesthetically pleasing.
Types become terse with only the information you need at a first glance.
Furthermore, for consistency, all types should begin with capital letters.</p>
<h3 id="numeric-types">Numeric Types</h3>
<h4 id="floats">Floats</h4>
<p>Most of the floating types that are mentioned in <a href="https://en.wikipedia.org/wiki/IEEE_754">IEEE 754</a>.</p>
<table>
  <thead>
      <tr>
          <th>Prelude</th>
          <th>Vanilla</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>BF16</code></td>
          <td>N/A</td>
      </tr>
      <tr>
          <td><code>F16</code></td>
          <td>N/A</td>
      </tr>
      <tr>
          <td><code>F32</code></td>
          <td><code>float</code></td>
      </tr>
      <tr>
          <td><code>D32</code></td>
          <td>N/A</td>
      </tr>
      <tr>
          <td><code>F64</code></td>
          <td><code>double</code></td>
      </tr>
      <tr>
          <td><code>D64</code></td>
          <td>N/A</td>
      </tr>
      <tr>
          <td><code>F80</code></td>
          <td>N/A or <code>long double</code></td>
      </tr>
      <tr>
          <td><code>D128</code></td>
          <td>N/A</td>
      </tr>
      <tr>
          <td><code>F128</code></td>
          <td>N/A</td>
      </tr>
  </tbody>
</table>
<p>Additional information on the <a href="https://en.wikipedia.org/wiki/Bfloat16_floating-point_format">brain floating data type</a>.</p>
<table>
  <thead>
      <tr>
          <th>Prelude</th>
          <th>Vanilla</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>Size</code></td>
          <td><code>std::size_t</code></td>
      </tr>
      <tr>
          <td><code>Int</code></td>
          <td>N/A</td>
      </tr>
      <tr>
          <td><code>U8</code></td>
          <td><code>uint8_t</code></td>
      </tr>
      <tr>
          <td><code>U16</code></td>
          <td><code>uint16_t</code></td>
      </tr>
      <tr>
          <td><code>U32</code></td>
          <td><code>uint32_t</code></td>
      </tr>
      <tr>
          <td><code>U64</code></td>
          <td><code>uint64_t</code></td>
      </tr>
      <tr>
          <td><code>U128</code></td>
          <td>N/A</td>
      </tr>
      <tr>
          <td><code>I8</code></td>
          <td><code>int8_t</code></td>
      </tr>
      <tr>
          <td><code>I16</code></td>
          <td><code>int16_t</code></td>
      </tr>
      <tr>
          <td><code>I32</code></td>
          <td><code>int32_t</code></td>
      </tr>
      <tr>
          <td><code>I64</code></td>
          <td><code>int64_t</code></td>
      </tr>
      <tr>
          <td><code>I128</code></td>
          <td>N/A</td>
      </tr>
  </tbody>
</table>
<p>These changes beg the question: What is wrong with <code>int</code>?
Well <code>int</code> would be a perfectly valid type if C++ supported Big Integers like
Java does. The problem is <code>int</code> is fixed to a type that is <em>sometimes</em> 32-bits
and other times something else. I think this is very inelegant and needlessly
terse. It is better to simply know what kind of integer and bit-width it takes
up.</p>
<p>The only exception to this rule being <code>Size</code> and <code>Int</code>. For the former we want
to preserve the ability to scale depending on what system runs the binary. For
the latter we want to optimize the CI development cycle, so the less worries the
better. If you want an <code>Int</code> then have an <code>Int</code>.</p>
<h3 id="other-types">Other Types</h3>
<table>
  <thead>
      <tr>
          <th>Prelude</th>
          <th>Vanilla</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>Unit</code></td>
          <td><code>void</code></td>
      </tr>
      <tr>
          <td><code>Void</code></td>
          <td>N/A</td>
      </tr>
      <tr>
          <td><code>Bool</code></td>
          <td><code>bool</code></td>
      </tr>
      <tr>
          <td><code>Char</code></td>
          <td><code>char</code></td>
      </tr>
      <tr>
          <td><code>Handle&lt;T&gt;</code></td>
          <td><code>T*</code></td>
      </tr>
      <tr>
          <td><code>Ref&lt;T&gt;</code></td>
          <td><code>T&amp;</code></td>
      </tr>
      <tr>
          <td><code>Vector</code></td>
          <td><code>std::vector&lt;T&gt;</code></td>
      </tr>
      <tr>
          <td><code>String</code></td>
          <td><code>std::string</code></td>
      </tr>
      <tr>
          <td><code>CString</code></td>
          <td><code>const char *</code></td>
      </tr>
  </tbody>
</table>
<p>In most situations, it is clearer to write the type as a <code>Handle&lt;T&gt;</code> than a <code>T*</code>.
Same goes for <code>Ref&lt;T&gt;</code>.
This also remains consistent with the implementation of smart pointers in the
standard library, for example <code>std::unique_ptr&lt;T&gt;</code>.</p>
<p><code>std::string_literals</code> are enabled by default.</p>
<h2 id="keywords">Keywords</h2>
<table>
  <thead>
      <tr>
          <th>Prelude</th>
          <th>Vanilla</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>let</code></td>
          <td><code>auto const</code></td>
      </tr>
      <tr>
          <td><code>var</code></td>
          <td><code>auto</code></td>
      </tr>
      <tr>
          <td><code>fn</code></td>
          <td><code>[[nodiscard, gnu::const]] auto</code></td>
      </tr>
      <tr>
          <td><code>proc</code></td>
          <td><code>[[nodiscard]] auto</code></td>
      </tr>
      <tr>
          <td><code>ignored = foo();</code></td>
          <td><code>static_cast&lt;void&gt;(foo());</code></td>
      </tr>
      <tr>
          <td><code>fst</code></td>
          <td><code>std::get&lt;0&gt;</code></td>
      </tr>
      <tr>
          <td><code>snd</code></td>
          <td><code>std::get&lt;1&gt;</code></td>
      </tr>
      <tr>
          <td><code>thr</code></td>
          <td><code>std::get&lt;2&gt;</code></td>
      </tr>
  </tbody>
</table>
<p>You define terms as <code>let x = 0;</code>. If you need the term to be of any specific
numeric type then use suffixes like: <code>let x = 0u;</code> (x is unsigned).
If you need a variable term then use the <code>var</code> keyword instead. The motivation
for this is that you should prefer immutable terms before considering mutable
variables.</p>
<p>All functions should be <code>[[nodiscard]]</code> and be annotated with trailing return
types.
If you need to ignore the return value of a function then use <code>ignore = ...</code> to
explicitly ignore it.
Additionally, the term <code>fn</code> (function) should be used in its most literal
mathematical sense, for a given input it will always produce the same output.
If you want to do something that requires side effects then use the <code>proc</code>
(procedure) keyword instead.</p>
<p><code>fst</code>, <code>snd</code> and <code>thr</code> naming conventions are taken from Haskell. The motivation
being that <code>std::get&lt;#&gt;</code> is extremely verbose for accessing the
first/second/third/etc members of that tuple.</p>
<h2 id="better-main">Better Main</h2>
<p>The way <code>main</code> is defined for use is very old. It is not type safe and uses old
types like c-strings. We can, instead, make a better <code>Main</code> that is the one we
define our program in and forward the arguments in a type-safe manner.</p>
<p>Implementation taken from <a href="https://www.youtube.com/watch?v=zCzD9uSDI8c">C++ Weekly ep 361 by Jason Turner</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">I32</span> <span class="nf">main</span><span class="p">(</span><span class="k">const</span> <span class="n">I32</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="n">Handle</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">CString</span><span class="o">&gt;</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// declare function inside main
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">proc</span> <span class="n">Main</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">span</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">noexcept</span> <span class="o">-&gt;</span> <span class="n">I32</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// pass arguments to safe main
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">let</span> <span class="n">args</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="o">&gt;</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">next</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">ptrdiff_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">argc</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">Main</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>NOTE: It has been mentioned that <code>argv</code> has historically been used for passing
sensitive information like passwords to programs. In that case, the array used
to store the different arguments is chopped up to remove the sensitive
information. For now, this method does not allow do that. Furthermore,
sending sensitive information through command line arguments is a bad idea IMO.</p>
<h3 id="short-example">Short example</h3>
<p>Solution for Rosetta Code &ldquo;<a href="https://rosettacode.org/wiki/Balanced_brackets">Balanced Brackets</a>&rdquo;
using this prelude.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;format&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;random&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;prelude.hpp&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">proc</span> <span class="nf">generate</span><span class="p">(</span><span class="n">I32</span> <span class="n">n</span><span class="p">,</span> <span class="n">Char</span> <span class="n">left</span> <span class="o">=</span> <span class="sc">&#39;[&#39;</span><span class="p">,</span> <span class="n">Char</span> <span class="n">right</span> <span class="o">=</span> <span class="sc">&#39;]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">var</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">random_device</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">var</span> <span class="n">str</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">left</span><span class="p">)</span> <span class="o">+</span> <span class="n">String</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">right</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">std</span><span class="o">::</span><span class="n">shuffle</span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">str</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">std</span><span class="o">::</span><span class="n">mt19937</span><span class="p">(</span><span class="n">rd</span><span class="p">()));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fn</span> <span class="nf">balanced</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">str</span><span class="p">,</span> <span class="n">Char</span> <span class="n">left</span> <span class="o">=</span> <span class="sc">&#39;[&#39;</span><span class="p">,</span> <span class="n">Char</span> <span class="n">right</span> <span class="o">=</span> <span class="sc">&#39;]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bool</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">var</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="n">let</span><span class="o">&amp;</span> <span class="nl">ch</span> <span class="p">:</span> <span class="n">str</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="n">left</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">count</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="n">right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">proc</span> <span class="nf">Main</span><span class="p">(</span><span class="na">[[maybe_unused]]</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">span</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="o">&gt;</span> <span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">I32</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="n">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">let</span> <span class="n">s</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">generate</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">ignore</span> <span class="o">=</span> <span class="n">println</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">		    <span class="n">std</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&#34; {}: {}&#34;</span><span class="p">,</span> <span class="n">balanced</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">?</span> <span class="s">&#34;ok&#34;</span> <span class="o">:</span> <span class="s">&#34;bad&#34;</span><span class="p">,</span> <span class="n">s</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h1 id="todo">TODO:</h1>
<ul>
<li><input disabled="" type="checkbox"> Add algorithms</li>
<li><input disabled="" type="checkbox"> Improve range algorithms</li>
</ul>
  


  </main>
  <footer>
    <p>Copyright 2025. All rights reserved.</p>

  </footer>
  <div class="debug-grid"></div>
  <script src="/js/main.js"></script>
</body>
</html>
