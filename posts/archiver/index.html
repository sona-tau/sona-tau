<!doctype html><html lang=en-US dir=ltr id=html><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta property="og:title" content="Sona's website!"><meta property="og:description" content="Sona's website for publishing projects, blogs and more!"><meta property="og:image" content="https://stau.space/banner.png"><meta property="og:url" content="https://stau.space"><meta property="og:type" content="website"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Sona's website!"><meta name=twitter:description content="Sona's website for publishing projects, blogs and more!"><meta name=twitter:image content="https://stau.space/banner.png"><meta name=twitter:site content="@SunglYou"><meta content="#43B581" data-react-helmet=true name=theme-color><link rel=icon type=image/svg+xml href=/favicon.svg><link rel="shortcut icon" href=/favicon.ico><link rel=icon type=image/png href=/favicon-96x96.png sizes=96x96><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><meta name=apple-mobile-web-app-title content="sona"><link rel=manifest href=/site.webmanifest><title>Archiver | My website!</title>
<link rel=stylesheet href=/css/main.min.68e80e38705d657e07edd114312c67d599b03ee0461d443ebaf91953b3e6a8af.css integrity="sha256-aOgOOHBdZX4H7dEUMSxn1ZmwPuBGHUQ+uvkZU7PmqK8=" crossorigin=anonymous><link rel=stylesheet href=/css/syntax.min.1a2121ca5da618cf1c3f9fd4fedab140ef1e066c21444768e5b2965bc9a98f15.css><script src=/js/main.fb6f33b6c27ddc1f3426f171446c7a52eff6151b8f221a0dcb9abd3345ebcc14.js integrity="sha256-+28ztsJ93B80JvFxRGx6Uu/2FRuPIhoNy5q9M0XrzBQ=" crossorigin=anonymous></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["\\(","\\)"]]},loader:{load:["ui/safe"]}}</script></head><body><header><a href=/><img class=logo src=/images/favicon_hu11784398669988935873.png width=512 height=512 alt></a><nav><a class=navItem href=/posts/>Posts</a>
<a class=navItem href=/tags/>Tags</a>
<a class=navItem href=/about/>About</a></nav><table class=header><tr><td style=width:100%><h1 class=title>Archiver</h1><span class=subtitle></span></table></header><main><p>Want to archive folders however you want?<h1 id=context>Context</h1><p>I had been trying to figure out a more efficient way of backing up directories on my computers. For example, I have a huge directory where my <a href=https://obsidian.md/>Obsidian</a> vault lives. This vault is filled with a bunch of pdf and markdown files that I use for my everyday notes. <em>I do like keeping this folder backed up in case my laptop or PC dies.</em><p>The way I would backup this folder was by simply turning it into a GitHub repo and uploading everything privately to my GitHub account. This was not what GitHub was made for and I was nearing 2GB for the entire repo. It was time to search for a different solution.<p>Enter the infamous <code>xz</code> vulnerability. This put compression libraries on my radar. So I decided to get the entire directory and compress it down using <code>xz</code> and <code>gzip</code>. I noticed that the compression on <code>xz</code> was far better than <code>gzip</code>. For my purposes I wanted to optimize for size at the cost of compression speed. Additionally the nice people at <a href=https://reddit.com/r/DataHoarder>r/DataHoarder</a> had mentioned that a really cool software program called <code>par2</code> was a thing. I could recover any amount I wanted from a specific file, using bit parity magic.<p>For my purposes, I want to store big directories as small as possible, store their MD5-Sum to make sure I can verify the files are correct, and store their parity file to be able to recover any part of them I want (up to 30% in my case). This is because sharing things on a local NAS or even with <a href=https://syncthing.net/>Syncthing</a> this way would be very easy and efficient.<p>Some downsides to this system are:<ul><li><code>xz</code> is not as common as I thought and it&rsquo;s been somewhat complicated to move files to systems that don&rsquo;t have this utility.<li>Incremental backups are not possible.</ul><p><em>PS</em>: I recognize that <code>xz</code> might have vulnerabilities that might not be.<h1 id=archiver>Archiver</h1><p>Archiver is a bash script that helps you backup whatever you want, however you want.<h2 id=usage>Usage</h2><p>For example:<p><code>archive.json</code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Wallpapers&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;~/Media/Pictures/Wallpapers&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;archive&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;walls&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;destination&#34;</span><span class=p>:</span> <span class=s2>&#34;~/OneDrive/Wallpapers&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;timestamps&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;last_archive&#34;</span><span class=p>:</span> <span class=mi>1712438594</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;last_upload&#34;</span><span class=p>:</span> <span class=mi>1712438693</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sync_command&#34;</span><span class=p>:</span> <span class=s2>&#34;onedrive --synchronize --single-directory &#39;Wallpapers&#39;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;md5sum&#34;</span><span class=p>:</span> <span class=s2>&#34;6de26f11ad638fd145f3d1412e0bf1c6&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Books&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;~/Documents/Books&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;archive&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;books&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;destination&#34;</span><span class=p>:</span> <span class=s2>&#34;~/OneDrive/Books&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;timestamps&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;last_archive&#34;</span><span class=p>:</span> <span class=mi>1712439022</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;last_upload&#34;</span><span class=p>:</span> <span class=mi>1712439638</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sync_command&#34;</span><span class=p>:</span> <span class=s2>&#34;onedrive --synchronize --single-directory &#39;Books&#39;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;md5sum&#34;</span><span class=p>:</span> <span class=s2>&#34;b4ae6185bb5a20d19c0b30f9778a10cb&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></table></div></div><p>You specify list of attribute sets with three key parts:<ul><li><code>target</code>: the target directory you wish to backup<li><code>archive</code>: the name of the archive and where you want to store the archive<li><code>sync_command</code>: the command you wish to use to back up this specific directory</ul><p>Other details like <code>timestamps</code> and <code>name</code> are useful for other purposes if you wish to climb under the hood to use them. The MD5-Sum is also useful if you wish to verify the legitimacy of your files after retrieving them.<p><em>PS:</em> an example <code>archives.json</code> is provided.<h2 id=methodology>Methodology</h2><ol><li>Your <code>target</code> gets converted into a tarball.<li>That tarball is compressed into an <code>xz</code> archive.<ul><li>This format was chosen because of its excellent compression ratio.<li>Though in the future I would like to implement multiple formats for this.</ul><li>A parity archive is created from that compressed tarball.<ul><li>Uses the <code>par2cmdline</code> utilities.<li>A single block file with 30% redundancy is created.<li>Additionally, you can use the index file that&rsquo;s created but <code>par2</code> doesn&rsquo;t really need it.</ul><li>A unix timestamp and MD5-Sum is taken from the archived tarball.<li>Your <code>sync_command</code> hook is run at the end and a secondary timestamp is taken
at the end of this.<li>Your <code>archives.json</code> file is updated with all of the fresh timestamps and
MD5-Sum.</ol></main><footer><div class=footerLeft><a class=navItem href=https://git.gay/sona/site/><svg width="20" height="20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 8l-4 4 4 4"/><path d="M17 8l4 4-4 4"/><path d="M14 4l-4 16"/></svg> Source Code</a>
<a class=navItem href=/index.xml><svg width="20" height="20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg> RSS</a>
<a class=navItem href=/contact/><svg width="20" height="20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M20 6v12a2 2 0 01-2 2H8a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2z"/><path d="M10 16h6"/><path d="M13 11m-2 0a2 2 0 104 0 2 2 0 10-4 0"/><path d="M4 8h3"/><path d="M4 12h3"/><path d="M4 16h3"/></svg> Contact</a>
<a class=navItem href=/todo/><svg width="20" height="20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 6a2 2 0 10-4 0 2 2 0 004 0z"/><path d="M7 18a2 2 0 10-4 0 2 2 0 004 0z"/><path d="M21 18a2 2 0 10-4 0 2 2 0 004 0z"/><path d="M7 18h10"/><path d="M18 16l-5-8"/><path d="M11 8l-5 8"/></svg> Webring</a></div><div class=footerRight>Copyright 2025. All rights reserved.<br>All articles are licensed under: <a href=https://creativecommons.org/licenses/by-nc/4.0/>CC&nbsp;BY-NC-SA&nbsp;4.0.</a><br>Last rev <time>2025-07-07</time> (<a href=https://git.gay/sona/site/commit/8ac9c84>8ac9c84</a>)<br>Author: <a href=mailto:sona@stau.space><i>Sona T. Estrada Rivera</i></a><br><abbr title=Puertorican>ðŸ‡µðŸ‡·</abbr>
<abbr title=Pansexual><svg height="1em" viewBox="0 -5 36 36"><g transform="rotate(0)" clip-path="url(#stripesClip)"><rect x="0" y="5" width="36" height="8.767" fill="#ff218c"/><rect x="0" y="13.667" width="36" height="8.767" fill="#fed800"/><rect x="0" y="22.333" width="36" height="8.767" fill="#21b1ff"/></g><defs><clipPath id="stripesClip"><path id="stripes" fill="#eee" d="M36 27c0 2.209-1.791 4-4 4H4c-2.209.0-4-1.791-4-4V9c0-2.209 1.791-4 4-4h28c2.209.0 4 1.791 4 4v18z" transform="rotate(0)"/></clipPath></defs></svg></abbr>
<abbr title=Transexual><svg height="1em" viewBox="0 -5 36 36"><g transform="rotate(0)" clip-path="url(#stripesClip)"><rect x="0" y="5" width="36" height="5.3" fill="#5bcefa"/><rect x="0" y="10.2" width="36" height="5.3" fill="#f5a9b8"/><rect x="0" y="15.4" width="36" height="5.3" fill="#fff"/><rect x="0" y="20.6" width="36" height="5.3" fill="#f5a9b8"/><rect x="0" y="25.8" width="36" height="5.3" fill="#5bcefa"/></g><defs><clipPath id="stripesClip"><path id="stripes" fill="#eee" d="M36 27c0 2.209-1.791 4-4 4H4c-2.209.0-4-1.791-4-4V9c0-2.209 1.791-4 4-4h28c2.209.0 4 1.791 4 4v18z" transform="rotate(0)"/></clipPath></defs></svg></abbr></div></footer><div style="position:fixed;left:10px;bottom:5px;background:0 0"><label class=themeToggleLabel><button class=themeToggle><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" class="icon icon-tabler icons-tabler-filled icon-tabler-moon"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 1.992a10 10 0 109.236 13.838c.341-.82-.476-1.644-1.298-1.31A6.5 6.5.0 0113.074 3.733l.077-.08c.551-.63.113-1.653-.758-1.653h-.266l-.068-.006-.06-.002z"/></svg></button></label></div></body></html>