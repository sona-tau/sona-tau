<!doctype html><html lang=en-US dir=ltr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><title>Archiver | My website!</title><meta name=author content="Sona Tau Estrada Rivera"><meta name=description content="Want to archive folders however you want?
"><link rel=canonical href=http://localhost:1313/posts/archiver/><script src=http://localhost:1313/js/hugo-brewm.min.js defer></script><link rel=stylesheet href=http://localhost:1313/css/hugo-brewm.min.css><style>body {max-width: 786px; margin: auto; padding: 2rem;} img {max-width: 86vw;}</style></head><body><header class=pagewidth><div id=background-header class=background aria-hidden=true></div><nav aria-label=Bypass><a id=to-content href=#content aria-label="Skip to Main Content"><span>Skip to Main Content</span>
<kbd class=key aria-hidden=true data-key=c></kbd>
<span class=screening aria-hidden=true></span></a></nav><details class=presentation id=top-nav><summary class=on-deck><span class=t>Navigation</span>
<span class=menu-icon role=presentation></span></summary><nav tabindex=-1 aria-label=Top><details id=has-main-menu class=presentation open><summary class=hide aria-label="Main Menu"><span>Main Menu</span></summary><nav id=main-menu aria-label="Main Menu"><ul class="l1 has-childfree" role=presentation tabindex=-1><li role=presentation><a class=on-deck href=/><span>Home</span></a><li role=presentation><a aria-current=true class=on-deck href=/posts/><span>Posts</span></a><li role=presentation><a class=on-deck href=/tags/><span>Tags</span></a></ul></nav></details></nav><div id=top-nav-screen class="screening js-cpn" role=presentation aria-hidden=true></div><hr class=hide></details></header><main id=page class=page><header class=pagewidth><menu id=menu class=srm data-i18n-back="Go Back" data-i18n-print=Print data-i18n-copy="Copy URL" data-i18n-copying=Copying...><li><a id=navigatorShare href=#mastodon role=button aria-label=Share><span class="t srt" role=tooltip>Share</span></a></menu><details class=presentation aria-expanded=true id=has-breadcrumb open><summary id=breadcrumb tabindex=-1><span>Breadcrumb</span></summary><nav aria-labelledby=breadcrumb><ul role=presentation class=breadcrumb><li><a href=http://localhost:1313/posts/ aria-current=true>Posts</a><li><a href aria-current=page tabindex=-1>Archiver</a></ul></nav></details><hr class=hide></header><div id=top role=presentation></div><article id=main-article class="pagewidth sf" role=document aria-labelledby=title data-pagefind-ignore=all><header aria-labelledby=title><h1 id=title data-bionread-safe>Archiver</h1></header><section id=content class=content aria-labelledby=title data-bionread-safe><p>Want to archive folders however you want?<h1 id=context>Context</h1><p>I had been trying to figure out a more efficient way of backing up directories on my computers. For example, I have a huge directory where my <a href=https://obsidian.md/ target=_blank rel="external noopener noreferrer nofollow">Obsidian</a> vault lives. This vault is filled with a bunch of pdf and markdown files that I use for my everyday notes. <em>I do like keeping this folder backed up in case my laptop or PC dies.</em><p>The way I would backup this folder was by simply turning it into a GitHub repo and uploading everything privately to my GitHub account. This was not what GitHub was made for and I was nearing 2GB for the entire repo. It was time to search for a different solution.<p>Enter the infamous <code>xz</code> vulnerability. This put compression libraries on my radar. So I decided to get the entire directory and compress it down using <code>xz</code> and <code>gzip</code>. I noticed that the compression on <code>xz</code> was far better than <code>gzip</code>. For my purposes I wanted to optimize for size at the cost of compression speed. Additionally the nice people at <a href=https://reddit.com/r/DataHoarder target=_blank rel="external noopener noreferrer nofollow">r/DataHoarder</a> had mentioned that a really cool software program called <code>par2</code> was a thing. I could recover any amount I wanted from a specific file, using bit parity magic.<p>For my purposes, I want to store big directories as small as possible, store their MD5-Sum to make sure I can verify the files are correct, and store their parity file to be able to recover any part of them I want (up to 30% in my case). This is because sharing things on a local NAS or even with <a href=https://syncthing.net/ target=_blank rel="external noopener noreferrer nofollow">Syncthing</a> this way would be very easy and efficient.<p>Some downsides to this system are:<ul><li><code>xz</code> is not as common as I thought and it&rsquo;s been somewhat complicated to move files to systems that don&rsquo;t have this utility.<li>Incremental backups are not possible.</ul><p><em>PS</em>: I recognize that <code>xz</code> might have vulnerabilities that might not be.<h1 id=archiver>Archiver</h1><p>Archiver is a bash script that helps you backup whatever you want, however you want.<h2 id=usage>Usage</h2><p>For example:<p><code>archive.json</code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Wallpapers&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;~/Media/Pictures/Wallpapers&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;archive&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;walls&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;destination&#34;</span><span class=p>:</span> <span class=s2>&#34;~/OneDrive/Wallpapers&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;timestamps&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;last_archive&#34;</span><span class=p>:</span> <span class=mi>1712438594</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;last_upload&#34;</span><span class=p>:</span> <span class=mi>1712438693</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sync_command&#34;</span><span class=p>:</span> <span class=s2>&#34;onedrive --synchronize --single-directory &#39;Wallpapers&#39;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;md5sum&#34;</span><span class=p>:</span> <span class=s2>&#34;6de26f11ad638fd145f3d1412e0bf1c6&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Books&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;~/Documents/Books&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;archive&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;books&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;destination&#34;</span><span class=p>:</span> <span class=s2>&#34;~/OneDrive/Books&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;timestamps&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;last_archive&#34;</span><span class=p>:</span> <span class=mi>1712439022</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;last_upload&#34;</span><span class=p>:</span> <span class=mi>1712439638</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sync_command&#34;</span><span class=p>:</span> <span class=s2>&#34;onedrive --synchronize --single-directory &#39;Books&#39;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;md5sum&#34;</span><span class=p>:</span> <span class=s2>&#34;b4ae6185bb5a20d19c0b30f9778a10cb&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></table></div></div><p>You specify list of attribute sets with three key parts:<ul><li><code>target</code>: the target directory you wish to backup<li><code>archive</code>: the name of the archive and where you want to store the archive<li><code>sync_command</code>: the command you wish to use to back up this specific directory</ul><p>Other details like <code>timestamps</code> and <code>name</code> are useful for other purposes if you wish to climb under the hood to use them. The MD5-Sum is also useful if you wish to verify the legitimacy of your files after retrieving them.<p><em>PS:</em> an example <code>archives.json</code> is provided.<h2 id=methodology>Methodology</h2><ol><li>Your <code>target</code> gets converted into a tarball.<li>That tarball is compressed into an <code>xz</code> archive.<ul><li>This format was chosen because of its excellent compression ratio.<li>Though in the future I would like to implement multiple formats for this.</ul><li>A parity archive is created from that compressed tarball.<ul><li>Uses the <code>par2cmdline</code> utilities.<li>A single block file with 30% redundancy is created.<li>Additionally, you can use the index file that&rsquo;s created but <code>par2</code> doesn&rsquo;t really need it.</ul><li>A unix timestamp and MD5-Sum is taken from the archived tarball.<li>Your <code>sync_command</code> hook is run at the end and a secondary timestamp is taken
at the end of this.<li>Your <code>archives.json</code> file is updated with all of the fresh timestamps and
MD5-Sum.</ol></section></article><div id=exclude role=presentation><hr class=hide style="margin:1in 0"><div id=contentinfo class=pagewidth role=contentinfo data-pagefind-ignore=all></div></div></main><footer id=body-footer class=pagewidth><div id=background-footer class="background hide" role=presentation aria-hidden=true></div><div id=focusMode></div><details id=has-a11y class="presentation js-details hide" name=on-deck aria-haspopup=true aria-labelledby=has-a11y-summary data-i18n-accessibility=Accessibility data-i18n-optimizesr="Screen Reader Optimization" data-i18n-optimizesrdesc="Optimize display and resources for screen reader users who navigate with a pointer device." data-i18n-colorsettings="Color Settings" data-i18n-darkmode="Dark Mode" data-i18n-light=Light data-i18n-dark=Dark data-i18n-contrast=Contrast data-i18n-lesscontrast=Low data-i18n-morecontrast=High data-i18n-defaultcontrast=Default data-i18n-colorpalette="Color Palette" data-i18n-defaultcolor=Default data-i18n-deuteranopia=Deuteranopia data-i18n-protanopia=Protanopia data-i18n-tritanopia=Tritanopia data-i18n-monochrome=Monochrome data-i18n-fontsize="Font Size" data-i18n-baselinestretch="Baseline Stretch" data-i18n-opendyslexic="Use OpenDyslexic Font" data-i18n-menucontrols="Accessibility Menu Controls" data-i18n-save=Save data-i18n-reset=Reset data-i18n-close=Close data-i18n-bionread="BionRead Mode" data-i18n-focusmode="Focus Mode" data-i18n-nolocalstorage="LocalStorage is not available in your browser. Settings won't be saved."></details><div id=useBionRead class=sri></div><nav aria-label=Bypass><a id=to-top class=srm href=#top title="To Content Top" accesskey=c aria-keyshortcuts=c aria-label="To Content Top"><span class="t srt">To Content Top</span>
<kbd class=key aria-hidden=true data-key=c></kbd></a></nav></footer><div id=bionReadSnapshot hidden></div><div id=background-body role=presentation aria-hidden=true></div></html>