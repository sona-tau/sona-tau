<!DOCTYPE html>
<html lang="en-US" dir="ltr" id="html">
<head>
	<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<meta property="og:title" content="Sona's blog!">
<meta property="og:description" content="Sona's website for publishing projects, blogs and more!">
<meta property="og:image" content="https://stau.space/banner.png">
<meta property="og:url" content="https://stau.space">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Sona's blog!">
<meta name="twitter:description" content="Sona's website for publishing projects, blogs and more!">
<meta name="twitter:image" content="https://stau.space/banner.png">
<meta name="twitter:site" content="@SunglYou">
<meta content="#43B581" data-react-helmet="true" name="theme-color" />
<title>Archiver | My website!</title>


<style>
body {
	font-family: 'IBM Plex Mono';
}
code {
	font-family: 'IBM Plex Mono'; 
}
</style>


			<link rel="stylesheet" href="/css/main.min.6e1b8e6633f62da60dbb95c4e19b780a7dab1210c54b9ca8f3f83ad53df87c1e.css" integrity="sha256-bhuOZjP2LaYNu5XE4Zt4Cn2rEhDFS5yo8/g61T34fB4=" crossorigin="anonymous">
		<link rel="stylesheet" href="/css/syntax.min.1b174baa023a0ab671cb0a1ccf6321b2318eb24ac5e55b8e549e89531d8ede59.css" />


			<script src="/js/main.fb6f33b6c27ddc1f3426f171446c7a52eff6151b8f221a0dcb9abd3345ebcc14.js" integrity="sha256-&#43;28ztsJ93B80JvFxRGx6Uu/2FRuPIhoNy5q9M0XrzBQ=" crossorigin="anonymous"></script>


	
		<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)']]                  
    },
    loader:{
      load: ['ui/safe']
    },
  };
</script>

	
	<link rel="shortcut icon" href="/favicon.ico" />
	<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
	<meta name="apple-mobile-web-app-title" content="stau.space" />
	<link rel="manifest" href="/site.webmanifest" />
</head>
<body>
<table class="header">
	<tr>
		<td style="width:100%">
			<h1 class="title">Archiver</h1>
			<span class="subtitle"></span>
		</td>
	</tr>
</table>



<main>
	
	<p>Want to archive folders however you want?</p>
<h1 id="context">Context</h1>
<p>I had been trying to figure out a more efficient way of backing up directories on my computers. For example, I have a huge directory where my <a href="https://obsidian.md/">Obsidian</a> vault lives. This vault is filled with a bunch of pdf and markdown files that I use for my everyday notes. <em>I do like keeping this folder backed up in case my laptop or PC dies.</em></p>
<p>The way I would backup this folder was by simply turning it into a GitHub repo and uploading everything privately to my GitHub account. This was not what GitHub was made for and I was nearing 2GB for the entire repo. It was time to search for a different solution.</p>
<p>Enter the infamous <code>xz</code> vulnerability. This put compression libraries on my radar. So I decided to get the entire directory and compress it down using <code>xz</code> and <code>gzip</code>. I noticed that the compression on <code>xz</code> was far better than <code>gzip</code>. For my purposes I wanted to optimize for size at the cost of compression speed. Additionally the nice people at <a href="https://reddit.com/r/DataHoarder">r/DataHoarder</a> had mentioned that a really cool software program called <code>par2</code> was a thing. I could recover any amount I wanted from a specific file, using bit parity magic.</p>
<p>For my purposes, I want to store big directories as small as possible, store their MD5-Sum to make sure I can verify the files are correct, and store their parity file to be able to recover any part of them I want (up to 30% in my case). This is because sharing things on a local NAS or even with <a href="https://syncthing.net/">Syncthing</a> this way would be very easy and efficient.</p>
<p>Some downsides to this system are:</p>
<ul>
<li><code>xz</code> is not as common as I thought and it&rsquo;s been somewhat complicated to move files to systems that don&rsquo;t have this utility.</li>
<li>Incremental backups are not possible.</li>
</ul>
<p><em>PS</em>: I recognize that <code>xz</code> might have vulnerabilities that might not be.</p>
<h1 id="archiver">Archiver</h1>
<p>Archiver is a bash script that helps you backup whatever you want, however you want.</p>
<h2 id="usage">Usage</h2>
<p>For example:</p>
<p><code>archive.json</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Wallpapers&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;target&#34;</span><span class="p">:</span> <span class="s2">&#34;~/Media/Pictures/Wallpapers&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;archive&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;walls&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;destination&#34;</span><span class="p">:</span> <span class="s2">&#34;~/OneDrive/Wallpapers&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;timestamps&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;last_archive&#34;</span><span class="p">:</span> <span class="mi">1712438594</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;last_upload&#34;</span><span class="p">:</span> <span class="mi">1712438693</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;sync_command&#34;</span><span class="p">:</span> <span class="s2">&#34;onedrive --synchronize --single-directory &#39;Wallpapers&#39;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;md5sum&#34;</span><span class="p">:</span> <span class="s2">&#34;6de26f11ad638fd145f3d1412e0bf1c6&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Books&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;target&#34;</span><span class="p">:</span> <span class="s2">&#34;~/Documents/Books&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;archive&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;books&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;destination&#34;</span><span class="p">:</span> <span class="s2">&#34;~/OneDrive/Books&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;timestamps&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;last_archive&#34;</span><span class="p">:</span> <span class="mi">1712439022</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;last_upload&#34;</span><span class="p">:</span> <span class="mi">1712439638</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;sync_command&#34;</span><span class="p">:</span> <span class="s2">&#34;onedrive --synchronize --single-directory &#39;Books&#39;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;md5sum&#34;</span><span class="p">:</span> <span class="s2">&#34;b4ae6185bb5a20d19c0b30f9778a10cb&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>You specify list of attribute sets with three key parts:</p>
<ul>
<li><code>target</code>: the target directory you wish to backup</li>
<li><code>archive</code>: the name of the archive and where you want to store the archive</li>
<li><code>sync_command</code>: the command you wish to use to back up this specific directory</li>
</ul>
<p>Other details like <code>timestamps</code> and <code>name</code> are useful for other purposes if you wish to climb under the hood to use them. The MD5-Sum is also useful if you wish to verify the legitimacy of your files after retrieving them.</p>
<p><em>PS:</em> an example <code>archives.json</code> is provided.</p>
<h2 id="methodology">Methodology</h2>
<ol>
<li>Your <code>target</code> gets converted into a tarball.</li>
<li>That tarball is compressed into an <code>xz</code> archive.
<ul>
<li>This format was chosen because of its excellent compression ratio.</li>
<li>Though in the future I would like to implement multiple formats for this.</li>
</ul>
</li>
<li>A parity archive is created from that compressed tarball.
<ul>
<li>Uses the <code>par2cmdline</code> utilities.</li>
<li>A single block file with 30% redundancy is created.</li>
<li>Additionally, you can use the index file that&rsquo;s created but <code>par2</code> doesn&rsquo;t really need it.</li>
</ul>
</li>
<li>A unix timestamp and MD5-Sum is taken from the archived tarball.</li>
<li>Your <code>sync_command</code> hook is run at the end and a secondary timestamp is taken
at the end of this.</li>
<li>Your <code>archives.json</code> file is updated with all of the fresh timestamps and
MD5-Sum.</li>
</ol>
	


</main>

<footer>
	<div id="page-size" style="position:fixed;left:10px;bottom:5px;background:transparent;"></div>
<script>
	const req = new XMLHttpRequest();
	req.open("GET", document.location, true);
	req.send(null);
	req.onload = () => {
		const kilobytes = req.getResponseHeader("Content-Length") / 1024.0;
		document.getElementById("page-size").innerHTML = kilobytes.toFixed(2) + " kb";
	};
</script>
<p>
Copyright 2025. All rights reserved. <br> <br>
Last updated on <time>2024 12 08</time>. <br> <br>Author: <a href="mailto:sona@stau.space"><i>Suna T. Estrada Rivera</i></a>
</p>

</footer>

<div class="debug-grid"></div>

<script src="/js/main.js"></script>

</body>
</html>
