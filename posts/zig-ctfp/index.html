<!doctype html><html lang=en-US dir=ltr id=html><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta property="og:title" content="Sona's website!"><meta property="og:description" content="Sona's website for publishing projects, blogs and more!"><meta property="og:image" content="https://stau.space/banner.png"><meta property="og:url" content="https://stau.space"><meta property="og:type" content="website"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Sona's website!"><meta name=twitter:description content="Sona's website for publishing projects, blogs and more!"><meta name=twitter:image content="https://stau.space/banner.png"><meta name=twitter:site content="@SunglYou"><meta content="#43B581" data-react-helmet=true name=theme-color><link rel=icon type=image/svg+xml href=/favicon.svg><link rel="shortcut icon" href=/favicon.ico><link rel=icon type=image/png href=/favicon-96x96.png sizes=96x96><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><meta name=apple-mobile-web-app-title content="sona"><link rel=manifest href=/site.webmanifest><title>Zig CTFP | My website!</title>
<link rel=stylesheet href=/css/main.min.b258d5cfbbba7029cdeeaa1dd3e4df160efb6526f4010b9b55e9e74b983566d6.css integrity="sha256-sljVz7u6cCnN7qod0+TfFg77ZSb0AQubVennS5g1ZtY=" crossorigin=anonymous><link rel=stylesheet href=/css/syntax.min.1a2121ca5da618cf1c3f9fd4fedab140ef1e066c21444768e5b2965bc9a98f15.css><script src=/js/main.f2979a93a325fecf9605263bd141398a311c8e23388ed7dcff74f92f7e632866.js integrity="sha256-8peak6Ml/s+WBSY70UE5ijEcjiM4jtfc/3T5L35jKGY=" crossorigin=anonymous></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["\\(","\\)"]]},loader:{load:["ui/safe"]}}</script></head><body><header><a href=/><img class=logo src=/images/favicon_hu11784398669988935873.png width=512 height=512 alt></a><nav><a class=navItem href=/posts/>Posts</a>
<a class=navItem href=/tags/>Tags</a>
<a class=navItem href=/about/>About</a></nav><table class=header><tr><td style=width:100%><h1 class=title>Zig CTFP</h1><span class=subtitle>Zig is a functional programming language</span></table></header><main><p>Let this blog post be living proof that Zig is in fact also a functional
programming language.<h2 id=what>What?</h2><p>Well, there is a famous book called &ldquo;Category Theory For Programmers&rdquo; (in
short, CTFP) that expresses a lot of the core ideas of functional programming
through category theory. CTFP has a set of challenges at the end of each
chapter, and I aim to do all of them in Zig.<h2 id=challenges>Challenges</h2><h3 id=141>1.4.1</h3><blockquote><p>Implement, as best you can, the identity function in your favorite language
(or the second favorite, if your favorite language happens to be Haskell).</blockquote><p>For functional programming we will make heavy use of anonymous functions. So a
recurring pattern we will see is the following:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=k>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=n>call</span><span class=p>(</span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>&lt;</span><span class=n>function</span><span class=w> </span><span class=n>body</span><span class=w> </span><span class=n>here</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}.</span><span class=n>call</span><span class=p>;</span><span class=w> </span><span class=c1>// Notice this .call will make the expression return a function pointer.
</span></span></span></code></pre></table></div></div><h4 id=solution>Solution:</h4><p>So this challenge becomes very easy:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=k>fn</span><span class=w> </span><span class=n>id</span><span class=p>(</span><span class=kr>comptime</span><span class=w> </span><span class=n>T</span><span class=o>:</span><span class=w> </span><span class=kt>type</span><span class=p>)</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>T</span><span class=p>)</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>fn</span><span class=w> </span><span class=n>call</span><span class=p>(</span><span class=n>x</span><span class=o>:</span><span class=w> </span><span class=n>T</span><span class=p>)</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}.</span><span class=n>call</span><span class=p>;</span><span class=w> </span><span class=c1>// The .call for id.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></table></div></div><p>PS.<p>Since we don&rsquo;t have function type inference in zig, we will make use of types as
values. So the function call looks like:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=n>id</span><span class=p>(</span><span class=kt>i32</span><span class=p>)(</span><span class=mi>42</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></table></div></div><p>Some may be somewhat bothered by this syntax. But I think this is still fair
since C++&rsquo;s version of <code>id</code> without type inference (ie. using templates) is:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>id</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>42</span><span class=p>);</span>
</span></span></code></pre></table></div></div><h3 id=142>1.4.2</h3><blockquote><p>Implement the composition function in your favorite language. It takes two
functions as arguments and returns a function that is their composition.</blockquote><p>This is still very similar to the previous challenge but we do it twice nested.<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=k>fn</span><span class=w> </span><span class=n>compose</span><span class=p>(</span><span class=n>A</span><span class=o>:</span><span class=w> </span><span class=kt>type</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=o>:</span><span class=w> </span><span class=kt>type</span><span class=p>,</span><span class=w> </span><span class=n>C</span><span class=o>:</span><span class=w> </span><span class=kt>type</span><span class=p>)</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>B</span><span class=p>)</span><span class=w> </span><span class=n>C</span><span class=p>,</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>B</span><span class=p>)</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>C</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>fn</span><span class=w> </span><span class=n>call</span><span class=p>(</span><span class=n>f</span><span class=o>:</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>B</span><span class=p>)</span><span class=w> </span><span class=n>C</span><span class=p>,</span><span class=w> </span><span class=n>g</span><span class=o>:</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>B</span><span class=p>)</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>C</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>fn</span><span class=w> </span><span class=n>call</span><span class=p>(</span><span class=n>a</span><span class=o>:</span><span class=w> </span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>C</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=n>f</span><span class=p>(</span><span class=n>g</span><span class=p>(</span><span class=n>a</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}.</span><span class=n>call</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}.</span><span class=n>call</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></table></div></div><h4 id=solution-1>Solution:</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=kr>const</span><span class=w> </span><span class=n>square_one</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>compose</span><span class=p>(</span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>)(</span><span class=n>square</span><span class=p>,</span><span class=w> </span><span class=n>inc</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></table></div></div><p>You might notice that this only works for unary functions&mldr; Maybe in the future
I&rsquo;ll find a way to compose stuff in a better way. (maybe structs to pass multiple
parameters in a single parameter?)<h3 id=143>1.4.3</h3><blockquote><p>Write a program that tries to test that your composition function respects
identity.</blockquote><p>For this we need to verify that:<ol><li><code>f . id = f</code><li><code>id . f = f</code></ol><h4 id=solution-2>Solution:</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=k>test</span><span class=w> </span><span class=s>&#34;1.4.3&#34;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kr>const</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>inc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kr>const</span><span class=w> </span><span class=n>fid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>compose</span><span class=p>(</span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>)(</span><span class=n>inc</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>(</span><span class=kt>i32</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kr>const</span><span class=w> </span><span class=n>idf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>compose</span><span class=p>(</span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>)(</span><span class=n>id</span><span class=p>(</span><span class=kt>i32</span><span class=p>),</span><span class=w> </span><span class=n>inc</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>testing</span><span class=p>.</span><span class=n>expectEqual</span><span class=p>(</span><span class=n>fid</span><span class=p>(</span><span class=mi>42</span><span class=p>),</span><span class=w> </span><span class=n>f</span><span class=p>(</span><span class=mi>42</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>testing</span><span class=p>.</span><span class=n>expectEqual</span><span class=p>(</span><span class=n>idf</span><span class=p>(</span><span class=mi>42</span><span class=p>),</span><span class=w> </span><span class=n>f</span><span class=p>(</span><span class=mi>42</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></table></div></div><h3 id=271>2.7.1</h3><blockquote><p>Define a higher-order function (or a function object) <code>memoize</code> in your
favorite language. This function takes a pure function <code>f</code> as an argument and
returns a function that behaves almost exactly like <code>f</code>, except that it only
calls the original function once for every argument, stores the result
internallly, and subsequently returns this stored result every time it&rsquo;s called
with the same argument. You can tell the memoize function from the original by
watching its preformance. For instance, try to memoize a function that takes a
long time to evaluate. You&rsquo;ll have to wait for the result the first time you
call it, but on sebsquent calls, with the same argument, you should get the
result immediately.</blockquote><p>This one&rsquo;s a doozy&mldr;
Basically we need to create a function that will memoize another function.
As elegantly expressed in <a href=https://matt.might.net/articles/closure-conversion/>Closure Conversion: How to compile lambda</a>
a closure is simply a lambda that can capture its environment. The way we
capture the environment is simply by adding more data fields to the struct!
So we simply add a <code>AutoHashMap</code> as a data field to the struct.<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=k>fn</span><span class=w> </span><span class=n>memoize</span><span class=p>(</span><span class=kr>comptime</span><span class=w> </span><span class=n>A</span><span class=o>:</span><span class=w> </span><span class=kt>type</span><span class=p>,</span><span class=w> </span><span class=kr>comptime</span><span class=w> </span><span class=n>B</span><span class=o>:</span><span class=w> </span><span class=kt>type</span><span class=p>)</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>B</span><span class=p>)</span><span class=w> </span><span class=kt>type</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>fn</span><span class=w> </span><span class=n>call</span><span class=p>(</span><span class=kr>comptime</span><span class=w> </span><span class=n>f</span><span class=o>:</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>B</span><span class=p>)</span><span class=w> </span><span class=kt>type</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kr>var</span><span class=w> </span><span class=n>mp</span><span class=o>:</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>HashMap</span><span class=p>(</span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>hash_map</span><span class=p>.</span><span class=n>AutoContext</span><span class=p>(</span><span class=n>A</span><span class=p>),</span><span class=w> </span><span class=mi>80</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>std</span><span class=p>.</span><span class=n>AutoHashMap</span><span class=p>(</span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>).</span><span class=n>init</span><span class=p>(</span><span class=n>std</span><span class=p>.</span><span class=n>testing</span><span class=p>.</span><span class=n>allocator</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>fn</span><span class=w> </span><span class=n>call</span><span class=p>(</span><span class=n>a</span><span class=o>:</span><span class=w> </span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=kr>const</span><span class=w> </span><span class=n>val</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mp</span><span class=p>.</span><span class=n>get</span><span class=p>(</span><span class=n>a</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>val</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=n>v</span><span class=o>|</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>return</span><span class=w> </span><span class=n>v</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=kr>const</span><span class=w> </span><span class=n>new_val</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>f</span><span class=p>(</span><span class=n>a</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>mp</span><span class=p>.</span><span class=n>put</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=n>new_val</span><span class=p>)</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>{};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>return</span><span class=w> </span><span class=n>new_val</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>fn</span><span class=w> </span><span class=n>deinit</span><span class=p>()</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>mp</span><span class=p>.</span><span class=n>deinit</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>};</span><span class=w> </span><span class=c1>// Notice there isn&#39;t a .call here. The caller must call this
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>               </span><span class=c1>// closure with .call(args)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}.</span><span class=n>call</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></table></div></div><h4 id=solution-3>Solution</h4><p>And it works!<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=kr>const</span><span class=w> </span><span class=n>memo_fib</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memoize</span><span class=p>(</span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>)(</span><span class=n>fib</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>defer</span><span class=w> </span><span class=n>memo_fib</span><span class=p>.</span><span class=n>deinit</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>testing</span><span class=p>.</span><span class=n>expectEqual</span><span class=p>(</span><span class=n>fib</span><span class=p>(</span><span class=mi>5</span><span class=p>),</span><span class=w> </span><span class=n>memo_fib</span><span class=p>.</span><span class=n>call</span><span class=p>(</span><span class=mi>5</span><span class=p>));</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></table></div></div><h3 id=272>2.7.2</h3><blockquote><p>Try to memoize a function from your standard library that you normally use to
produce random numbers. Does it work?</blockquote><p>Apparently, it does!
But this is only because it is being executed with the same seed, at
compiletime.<h4 id=solution-4>Solution:</h4><p>Since I haven&rsquo;t figured out how to pass functions with different arity, we must
create a wrapper for the standard library&rsquo;s rng. This function will get rid of
that argument since we don&rsquo;t need it to produce the random numbers.<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=k>fn</span><span class=w> </span><span class=n>rand</span><span class=p>(</span><span class=n>_</span><span class=o>:</span><span class=w> </span><span class=kt>i32</span><span class=p>)</span><span class=w> </span><span class=kt>i32</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kr>const</span><span class=w> </span><span class=n>RndGen</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>rand</span><span class=p>.</span><span class=n>DefaultPrng</span><span class=p>;</span><span class=w> </span><span class=kr>var</span><span class=w> </span><span class=n>rnd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RndGen</span><span class=p>.</span><span class=n>init</span><span class=p>(</span><span class=nb>@as</span><span class=p>(</span><span class=kt>u64</span><span class=p>,</span><span class=w> </span><span class=nb>@bitCast</span><span class=p>(</span><span class=n>std</span><span class=p>.</span><span class=n>time</span><span class=p>.</span><span class=n>milliTimestamp</span><span class=p>())));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>rnd</span><span class=p>.</span><span class=n>random</span><span class=p>().</span><span class=n>int</span><span class=p>(</span><span class=kt>i32</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=c1>// Helper function
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kr>const</span><span class=w> </span><span class=n>RndGen</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>rand</span><span class=p>.</span><span class=n>DefaultPrng</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kr>var</span><span class=w> </span><span class=n>rnd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RndGen</span><span class=p>.</span><span class=n>init</span><span class=p>(</span><span class=nb>@as</span><span class=p>(</span><span class=kt>u64</span><span class=p>,</span><span class=w> </span><span class=nb>@bitCast</span><span class=p>(</span><span class=n>std</span><span class=p>.</span><span class=n>time</span><span class=p>.</span><span class=n>milliTimestamp</span><span class=p>())));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kr>const</span><span class=w> </span><span class=n>memo_rnd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memoize</span><span class=p>(</span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>)(</span><span class=n>rand</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>defer</span><span class=w> </span><span class=n>memo_rnd</span><span class=p>.</span><span class=n>deinit</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>testing</span><span class=p>.</span><span class=n>expectEqual</span><span class=p>(</span><span class=n>rnd</span><span class=p>.</span><span class=n>random</span><span class=p>().</span><span class=n>int</span><span class=p>(</span><span class=kt>i32</span><span class=p>),</span><span class=w> </span><span class=n>memo_rnd</span><span class=p>.</span><span class=n>call</span><span class=p>(</span><span class=mi>42</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></table></div></div><h2 id=la-fin>La Fin</h2><p>This is what I&rsquo;ve gotten up until now. Zig&rsquo;s syntax is ugly, and I&rsquo;m not
particularly excited about it&rsquo;s design philosophy but damn is it a solid
language. This little challenge has made me enjoy Zig a lot more than I thought.</main><footer><div class=footerLeft><a class=navItem href=https://git.gay/sona/site/><svg width="20" height="20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 8l-4 4 4 4"/><path d="M17 8l4 4-4 4"/><path d="M14 4l-4 16"/></svg> Source Code</a>
<a class=navItem href=/index.xml><svg width="20" height="20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg> RSS</a>
<a class=navItem href=/contact/><svg width="20" height="20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M20 6v12a2 2 0 01-2 2H8a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2z"/><path d="M10 16h6"/><path d="M13 11m-2 0a2 2 0 104 0 2 2 0 10-4 0"/><path d="M4 8h3"/><path d="M4 12h3"/><path d="M4 16h3"/></svg> Contact</a>
<a class=navItem href=/todo/><svg width="20" height="20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 6a2 2 0 10-4 0 2 2 0 004 0z"/><path d="M7 18a2 2 0 10-4 0 2 2 0 004 0z"/><path d="M21 18a2 2 0 10-4 0 2 2 0 004 0z"/><path d="M7 18h10"/><path d="M18 16l-5-8"/><path d="M11 8l-5 8"/></svg> Webring</a></div><div class=footerRight>Copyright 2025. All rights reserved.<br>All articles are licensed under: <a href=https://creativecommons.org/licenses/by-nc/4.0/>CC&nbsp;BY-NC-SA&nbsp;4.0.</a><br>Last rev <time>2025-03-20</time> (<a href=https://git.gay/sona/site/commit/c27bdf4>c27bdf4</a>)<br>Author: <a href=mailto:sona@stau.space><i>sona</i></a><br><abbr title=Puertorican>ðŸ‡µðŸ‡·</abbr>
<abbr title=Pansexual><svg height="1em" viewBox="0 -5 36 36"><g transform="rotate(0)" clip-path="url(#stripesClip)"><rect x="0" y="5" width="36" height="8.767" fill="#ff218c"/><rect x="0" y="13.667" width="36" height="8.767" fill="#fed800"/><rect x="0" y="22.333" width="36" height="8.767" fill="#21b1ff"/></g><defs><clipPath id="stripesClip"><path id="stripes" fill="#eee" d="M36 27c0 2.209-1.791 4-4 4H4c-2.209.0-4-1.791-4-4V9c0-2.209 1.791-4 4-4h28c2.209.0 4 1.791 4 4v18z" transform="rotate(0)"/></clipPath></defs></svg></abbr>
<abbr title=Transexual><svg height="1em" viewBox="0 -5 36 36"><g transform="rotate(0)" clip-path="url(#stripesClip)"><rect x="0" y="5" width="36" height="5.3" fill="#5bcefa"/><rect x="0" y="10.2" width="36" height="5.3" fill="#f5a9b8"/><rect x="0" y="15.4" width="36" height="5.3" fill="#fff"/><rect x="0" y="20.6" width="36" height="5.3" fill="#f5a9b8"/><rect x="0" y="25.8" width="36" height="5.3" fill="#5bcefa"/></g><defs><clipPath id="stripesClip"><path id="stripes" fill="#eee" d="M36 27c0 2.209-1.791 4-4 4H4c-2.209.0-4-1.791-4-4V9c0-2.209 1.791-4 4-4h28c2.209.0 4 1.791 4 4v18z" transform="rotate(0)"/></clipPath></defs></svg></abbr></div></footer><div style="position:fixed;left:10px;bottom:5px;background:0 0;height:2em;width:2em"><label class=themeToggleLabel><input type=checkbox class=themeToggle></button></label></div></body></html>