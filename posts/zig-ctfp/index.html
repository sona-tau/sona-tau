<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><title>Zig CTFP | My website!</title><meta name=author content="Sona Tau Estrada Rivera"><meta name=description content="Zig is a functional programming language"><meta name=keywords content="math,category theory,programming,computer science"><link rel=canonical href=https://stau.space/posts/zig-ctfp/><link rel=alternate hreflang=en href=https://stau.space/posts/ttps/ title><link rel=alternate hreflang=en href=https://stau.space/posts/nasin-toki/ title><link rel=alternate hreflang=en href=https://stau.space/posts/hbd/ title><link rel=alternate hreflang=en href=https://stau.space/posts/tok-style/ title><link rel=alternate hreflang=en href=https://stau.space/posts/tok-mat-faq/ title><link rel=alternate hreflang=en href=https://stau.space/posts/kulupu-pini/ title><link rel=alternate hreflang=en href=https://stau.space/posts/burritos/ title><link rel=alternate hreflang=en href=https://stau.space/posts/licker/ title><link rel=alternate hreflang=en href=https://stau.space/posts/archiver/ title><link rel=alternate hreflang=en href=https://stau.space/posts/algorithms/ title><link rel=alternate hreflang=en href=https://stau.space/posts/stuff/ title><link rel=alternate hreflang=en href=https://stau.space/posts/enchiridion-tok/ title><link rel=alternate hreflang=en href=https://stau.space/posts/aoc-2024-day1/ title><link rel=alternate hreflang=en href=https://stau.space/posts/aoc-2024-day2/ title><link rel=alternate hreflang=en href=https://stau.space/posts/tok-mat/ title><link rel=alternate hreflang=en href=https://stau.space/posts/hare-rope/ title><link rel=alternate hreflang=en href=https://stau.space/posts/rdbm/ title><link rel=alternate hreflang=en href=https://stau.space/posts/cpp-prelude/ title><link rel=alternate hreflang=en href=https://stau.space/posts/mandelbrot/ title><link rel=alternate hreflang=en href=https://stau.space/posts/icpc-regionals/ title><link rel="shortcut icon" href=https://stau.space/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=https://stau.space/apple-touch-icon.png><meta name=apple-mobile-web-app-title content="My website!"><link rel=icon type=image/png href=https://stau.space/favicon-96x96.png sizes=96x96><link rel=icon type=image/svg+xml href=https://stau.space/favicon.svg><link rel=manifest href=https://stau.space/site.webmanifest><meta name=twitter:card content="summary"><meta name=twitter:title content="Zig CTFP | My website!"><meta name=twitter:description content="Zig is a functional programming language"><meta property="og:title" content="Zig CTFP | My website!"><meta property="og:description" content="Zig is a functional programming language"><meta property="og:type" content="article"><meta property="og:url" content="https://stau.space/posts/zig-ctfp/"><meta property="og:site_name" content="My website!"><script src=https://stau.space/js/hugo-brewm.min.js integrity=sha384-dNwfY90xa1lEwque39f3dGj9xlj4T8w+HwA2nl0c5+TvSCgwnqlvv0qgxzmXX7QL crossorigin=anonymous defer></script><link rel=stylesheet href=https://stau.space/css/hugo-brewm.min.css integrity="sha256-hjuXPxmc4ck5WOonV8HgavzDeutQ5mW6t3mek0BOfAI=" crossorigin=anonymous><style>body {max-width: 786px; margin: auto; padding: 2rem;} video, img {max-width: 86vw;}</style></head><body><header class=pagewidth><div id=background-header class=background aria-hidden=true></div><nav aria-label=Bypass><a id=to-content href=#content aria-label="Skip to Main Content"><span>Skip to Main Content</span>
<kbd class=key aria-hidden=true data-key=c></kbd>
<span class=screening aria-hidden=true></span></a></nav><div id=logo><a href=https://stau.space/ aria-label="My website!" aria-description=Homepage><img id=logomark--dark src=https://stau.space/favicon-dark.png alt="My website!">
<img id=logomark src=https://stau.space/favicon.png alt="My website!"></a><hr class=hide></div><details class=presentation id=top-nav><summary class=on-deck><span class=t>Navigation</span>
<span class=menu-icon role=presentation></span></summary><nav tabindex=-1 aria-label=Top><details id=has-main-menu class=presentation open><summary class=hide aria-label="Main Menu"><span>Main Menu</span></summary><nav id=main-menu aria-label="Main Menu"><ul class=l1 role=presentation tabindex=-1><li role=presentation><details class="presentation js-details" name=on-deck><summary class="anchor on-deck"><span>Series</span></summary><ul class="l2 on-plank" role=presentation><li role=presentation><a class=has-desc href=https://stau.space/categories/projects/ aria-label=Projects aria-description="A collection of all the projects I've worked on"><span>Projects</span></a><li role=presentation><a class=has-desc href=https://stau.space/tags/category-theory/ aria-label="Category Theory" aria-description="My category theory ramblings"><span>Category Theory</span></a></ul><div class="screening js-cpn" role=presentation aria-hidden=true></div></details><li role=presentation><details class="presentation js-details" name=on-deck><summary class="anchor on-deck"><span>Works</span></summary><ul class="l2 on-plank" role=presentation><li role=presentation><details class="presentation js-details"><summary class=anchor><span class=has-aria-label aria-label="Here are writings about the things I've done research on">Research</span></summary><ul class=l3 role=presentation><li role=presentation><a class=has-desc aria-label="REU - Villanova" aria-description="Counting arithmetical structures on double edged cycles"><span>REU - Villanova</span></a><li role=presentation><a class=has-desc aria-label="REU - MSRI-UP" aria-description="Underrepresented groups in the Mathematics community"><span>REU - MSRI-UP</span></a><li role=presentation><a class=has-desc aria-label="Multidimensional Costas Arrays" aria-description="New construction for Multidimensional almost Costas arrays"><span>Multidimensional Costas Arrays</span></a></ul></details></ul><div class="screening js-cpn" role=presentation aria-hidden=true></div></details></ul></nav></details><details id=has-search class="presentation js-details" name=on-deck><summary class="on-deck srm" accesskey=q aria-labelledby=search-label aria-keyshortcuts=q><span id=search-label class="t srt">Search</span></summary><div id=search class=on-hull><div role=presentation class="screening js-cgpn"></div></div><script src=https://stau.space/pagefind/pagefind-ui.js type=text/javascript></script><script>let pageFindInitialized=!1;const initPageFind=function(){if(!pageFindInitialized){new PagefindUI({element:"#search",showImages:!1,translations:{placeholder:"Search"}});const e=document.querySelector(".pagefind-ui__search-input");e&&(e.setAttribute("aria-label",e.getAttribute("placeholder")),e.setAttribute("name",e.getAttribute("placeholder"))),pageFindInitialized=!0,document.removeEventListener("DOMContentLoaded",initPageFind)}};document.addEventListener("DOMContentLoaded",initPageFind)</script><noscript id=has-search-fallback class=on-hull><form id=duckduckgo class="form on-plank" action=//duckduckgo.com/ role=search aria-label=Search><input type=hidden value=stau.space name=sites></input>
<input type=hidden value=1 name=kh></input>
<input type=hidden value=1 name=kn></input>
<input type=hidden value=1 name=kac></input>
<input class="ldots form__input" type=search placeholder=Search name=q role=searchbox></input>
<button class=form__button type=submit aria-label=Search>
<img src=https://duckduckgo.com/assets/logo_header.v109.svg alt=Search role=presentation aria-hidden=true></button></form><div role=presentation class="screening js-cgpn"></div></noscript></details><details id=has-more-menu class="presentation js-details" name=on-deck><summary accesskey="=" class="on-deck srm" aria-label="More Menu"><span class="t srt">More Menu</span>
<span class="menu-icon sri" role=presentation></span></summary><nav id=more-menu aria-label="More Menu"><ul class="l1 on-plank has-childfree" role=presentation tabindex=-1><li role=presentation><a href=https://stau.space/categories/reference/><span>Resources</span></a><li role=presentation><a href=https://stau.space/author/sona-tau-estrada-rivera/><span>About</span></a></ul><div class="screening js-cgpn" role=presentation aria-hidden=true></div></nav></details></nav><div id=top-nav-screen class="screening js-cpn" role=presentation aria-hidden=true></div><hr class=hide></details></header><main id=page class=post><header class=pagewidth><menu id=menu class=srm data-i18n-back="Go Back" data-i18n-print=Print data-i18n-copy="Copy URL" data-i18n-copying=Copying...><li><a id=navigatorShare href=#mastodon role=button aria-label=Share><span class="t srt" role=tooltip>Share</span></a></menu><a href=https://stau.space/>Home</a>
<a href=https://stau.space/posts/>Posts</a>
<a href=https://stau.space/tags/>Tags</a>
<a href=https://stau.space/about/>About</a><hr class=hide></header><div id=top role=presentation></div><article id=main-article class="pagewidth rm" role=document aria-labelledby=title data-pagefind-body><header aria-labelledby=title><h1 id=title data-pagefind-meta=title data-bionread-safe>Zig CTFP</h1><div id=doc-author class=textsw><span>Sona Tau Estrada Rivera</span></div><div id=timestamp><span>Published on</span>
<time datetime=2024-08-07T11:38:20-04:00>August 7, 2024</time>,
<span>modified on</span>
<time datetime=2025-12-06T20:01:13-04:00>December 6, 2025</time>.</div></header><section id=content class="content secnum" aria-labelledby=title data-bionread-safe><p>Let this blog post be living proof that Zig is in fact also a functional
programming language.<h2 id=what>What?</h2><p>Well, there is a famous book called &ldquo;Category Theory For Programmers&rdquo; (in
short, CTFP) that expresses a lot of the core ideas of functional programming
through category theory. CTFP has a set of challenges at the end of each
chapter, and I aim to do all of them in Zig.<h2 id=challenges>Challenges</h2><h3 id=141>1.4.1</h3><blockquote><p>Implement, as best you can, the identity function in your favorite language
(or the second favorite, if your favorite language happens to be Haskell).</blockquote><p>For functional programming we will make heavy use of anonymous functions. So a
recurring pattern we will see is the following:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=k>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>call</span><span class=p>(</span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>&lt;</span><span class=n>function</span><span class=w> </span><span class=n>body</span><span class=w> </span><span class=n>here</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}.</span><span class=n>call</span><span class=p>;</span><span class=w> </span><span class=c1>// Notice this .call will make the expression return a function pointer.
</span></span></span></code></pre></table></div></div><h4 id=solution>Solution:</h4><p>So this challenge becomes very easy:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=k>fn</span><span class=w> </span><span class=nf>id</span><span class=p>(</span><span class=kr>comptime</span><span class=w> </span><span class=n>T</span><span class=o>:</span><span class=w> </span><span class=kt>type</span><span class=p>)</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>T</span><span class=p>)</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>fn</span><span class=w> </span><span class=nf>call</span><span class=p>(</span><span class=n>x</span><span class=o>:</span><span class=w> </span><span class=n>T</span><span class=p>)</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}.</span><span class=n>call</span><span class=p>;</span><span class=w> </span><span class=c1>// The .call for id.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></table></div></div><p>PS.<p>Since we don&rsquo;t have function type inference in zig, we will make use of types as
values. So the function call looks like:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=nf>id</span><span class=p>(</span><span class=kt>i32</span><span class=p>)(</span><span class=mi>42</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></table></div></div><p>Some may be somewhat bothered by this syntax. But I think this is still fair
since C++&rsquo;s version of <code>id</code> without type inference (ie. using templates) is:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>id</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>42</span><span class=p>);</span>
</span></span></code></pre></table></div></div><h3 id=142>1.4.2</h3><blockquote><p>Implement the composition function in your favorite language. It takes two
functions as arguments and returns a function that is their composition.</blockquote><p>This is still very similar to the previous challenge but we do it twice nested.<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=k>fn</span><span class=w> </span><span class=nf>compose</span><span class=p>(</span><span class=n>A</span><span class=o>:</span><span class=w> </span><span class=kt>type</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=o>:</span><span class=w> </span><span class=kt>type</span><span class=p>,</span><span class=w> </span><span class=n>C</span><span class=o>:</span><span class=w> </span><span class=kt>type</span><span class=p>)</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>B</span><span class=p>)</span><span class=w> </span><span class=n>C</span><span class=p>,</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>B</span><span class=p>)</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>C</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>fn</span><span class=w> </span><span class=nf>call</span><span class=p>(</span><span class=n>f</span><span class=o>:</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>B</span><span class=p>)</span><span class=w> </span><span class=n>C</span><span class=p>,</span><span class=w> </span><span class=n>g</span><span class=o>:</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>B</span><span class=p>)</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>C</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>fn</span><span class=w> </span><span class=nf>call</span><span class=p>(</span><span class=n>a</span><span class=o>:</span><span class=w> </span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>C</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=nf>f</span><span class=p>(</span><span class=nf>g</span><span class=p>(</span><span class=n>a</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}.</span><span class=n>call</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}.</span><span class=n>call</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></table></div></div><h4 id=solution-1>Solution:</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=kr>const</span><span class=w> </span><span class=n>square_one</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>compose</span><span class=p>(</span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>)(</span><span class=n>square</span><span class=p>,</span><span class=w> </span><span class=n>inc</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></table></div></div><p>You might notice that this only works for unary functions&mldr; Maybe in the future
I&rsquo;ll find a way to compose stuff in a better way. (maybe structs to pass multiple
parameters in a single parameter?)<h3 id=143>1.4.3</h3><blockquote><p>Write a program that tries to test that your composition function respects
identity.</blockquote><p>For this we need to verify that:<ol><li><code>f . id = f</code><li><code>id . f = f</code></ol><h4 id=solution-2>Solution:</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=k>test</span><span class=w> </span><span class=s>&#34;1.4.3&#34;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kr>const</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>inc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kr>const</span><span class=w> </span><span class=n>fid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>compose</span><span class=p>(</span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>)(</span><span class=n>inc</span><span class=p>,</span><span class=w> </span><span class=nf>id</span><span class=p>(</span><span class=kt>i32</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kr>const</span><span class=w> </span><span class=n>idf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>compose</span><span class=p>(</span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>)(</span><span class=nf>id</span><span class=p>(</span><span class=kt>i32</span><span class=p>),</span><span class=w> </span><span class=n>inc</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>testing</span><span class=p>.</span><span class=nf>expectEqual</span><span class=p>(</span><span class=nf>fid</span><span class=p>(</span><span class=mi>42</span><span class=p>),</span><span class=w> </span><span class=nf>f</span><span class=p>(</span><span class=mi>42</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>testing</span><span class=p>.</span><span class=nf>expectEqual</span><span class=p>(</span><span class=nf>idf</span><span class=p>(</span><span class=mi>42</span><span class=p>),</span><span class=w> </span><span class=nf>f</span><span class=p>(</span><span class=mi>42</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></table></div></div><h3 id=271>2.7.1</h3><blockquote><p>Define a higher-order function (or a function object) <code>memoize</code> in your
favorite language. This function takes a pure function <code>f</code> as an argument and
returns a function that behaves almost exactly like <code>f</code>, except that it only
calls the original function once for every argument, stores the result
internallly, and subsequently returns this stored result every time it&rsquo;s called
with the same argument. You can tell the memoize function from the original by
watching its preformance. For instance, try to memoize a function that takes a
long time to evaluate. You&rsquo;ll have to wait for the result the first time you
call it, but on sebsquent calls, with the same argument, you should get the
result immediately.</blockquote><p>This one&rsquo;s a doozy&mldr;
Basically we need to create a function that will memoize another function.
As elegantly expressed in <a href=https://matt.might.net/articles/closure-conversion/ target=_blank rel="external noopener noreferrer nofollow">Closure Conversion: How to compile lambda</a>
a closure is simply a lambda that can capture its environment. The way we
capture the environment is simply by adding more data fields to the struct!
So we simply add a <code>AutoHashMap</code> as a data field to the struct.<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=k>fn</span><span class=w> </span><span class=nf>memoize</span><span class=p>(</span><span class=kr>comptime</span><span class=w> </span><span class=n>A</span><span class=o>:</span><span class=w> </span><span class=kt>type</span><span class=p>,</span><span class=w> </span><span class=kr>comptime</span><span class=w> </span><span class=n>B</span><span class=o>:</span><span class=w> </span><span class=kt>type</span><span class=p>)</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>B</span><span class=p>)</span><span class=w> </span><span class=kt>type</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>fn</span><span class=w> </span><span class=nf>call</span><span class=p>(</span><span class=kr>comptime</span><span class=w> </span><span class=n>f</span><span class=o>:</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>(</span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>B</span><span class=p>)</span><span class=w> </span><span class=kt>type</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kr>var</span><span class=w> </span><span class=n>mp</span><span class=o>:</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=nf>HashMap</span><span class=p>(</span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>hash_map</span><span class=p>.</span><span class=nf>AutoContext</span><span class=p>(</span><span class=n>A</span><span class=p>),</span><span class=w> </span><span class=mi>80</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>std</span><span class=p>.</span><span class=nf>AutoHashMap</span><span class=p>(</span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>).</span><span class=nf>init</span><span class=p>(</span><span class=n>std</span><span class=p>.</span><span class=n>testing</span><span class=p>.</span><span class=n>allocator</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>fn</span><span class=w> </span><span class=nf>call</span><span class=p>(</span><span class=n>a</span><span class=o>:</span><span class=w> </span><span class=n>A</span><span class=p>)</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=kr>const</span><span class=w> </span><span class=n>val</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mp</span><span class=p>.</span><span class=nf>get</span><span class=p>(</span><span class=n>a</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>val</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=n>v</span><span class=o>|</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>return</span><span class=w> </span><span class=n>v</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=kr>const</span><span class=w> </span><span class=n>new_val</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>f</span><span class=p>(</span><span class=n>a</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>mp</span><span class=p>.</span><span class=nf>put</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=n>new_val</span><span class=p>)</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>{};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>return</span><span class=w> </span><span class=n>new_val</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>fn</span><span class=w> </span><span class=nf>deinit</span><span class=p>()</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>mp</span><span class=p>.</span><span class=nf>deinit</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>};</span><span class=w> </span><span class=c1>// Notice there isn&#39;t a .call here. The caller must call this
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>               </span><span class=c1>// closure with .call(args)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}.</span><span class=n>call</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></table></div></div><h4 id=solution-3>Solution</h4><p>And it works!<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=kr>const</span><span class=w> </span><span class=n>memo_fib</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>memoize</span><span class=p>(</span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>)(</span><span class=n>fib</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>defer</span><span class=w> </span><span class=n>memo_fib</span><span class=p>.</span><span class=nf>deinit</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>testing</span><span class=p>.</span><span class=nf>expectEqual</span><span class=p>(</span><span class=nf>fib</span><span class=p>(</span><span class=mi>5</span><span class=p>),</span><span class=w> </span><span class=n>memo_fib</span><span class=p>.</span><span class=nf>call</span><span class=p>(</span><span class=mi>5</span><span class=p>));</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></table></div></div><h3 id=272>2.7.2</h3><blockquote><p>Try to memoize a function from your standard library that you normally use to
produce random numbers. Does it work?</blockquote><p>Apparently, it does!
But this is only because it is being executed with the same seed, at
compiletime.<h4 id=solution-4>Solution:</h4><p>Since I haven&rsquo;t figured out how to pass functions with different arity, we must
create a wrapper for the standard library&rsquo;s rng. This function will get rid of
that argument since we don&rsquo;t need it to produce the random numbers.<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre><td class=lntd><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=k>fn</span><span class=w> </span><span class=nf>rand</span><span class=p>(</span><span class=n>_</span><span class=o>:</span><span class=w> </span><span class=kt>i32</span><span class=p>)</span><span class=w> </span><span class=kt>i32</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kr>const</span><span class=w> </span><span class=n>RndGen</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>rand</span><span class=p>.</span><span class=n>DefaultPrng</span><span class=p>;</span><span class=w> </span><span class=kr>var</span><span class=w> </span><span class=n>rnd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RndGen</span><span class=p>.</span><span class=nf>init</span><span class=p>(</span><span class=nb>@as</span><span class=p>(</span><span class=kt>u64</span><span class=p>,</span><span class=w> </span><span class=nb>@bitCast</span><span class=p>(</span><span class=n>std</span><span class=p>.</span><span class=n>time</span><span class=p>.</span><span class=nf>milliTimestamp</span><span class=p>())));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>rnd</span><span class=p>.</span><span class=nf>random</span><span class=p>().</span><span class=nf>int</span><span class=p>(</span><span class=kt>i32</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=c1>// Helper function
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kr>const</span><span class=w> </span><span class=n>RndGen</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>rand</span><span class=p>.</span><span class=n>DefaultPrng</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kr>var</span><span class=w> </span><span class=n>rnd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RndGen</span><span class=p>.</span><span class=nf>init</span><span class=p>(</span><span class=nb>@as</span><span class=p>(</span><span class=kt>u64</span><span class=p>,</span><span class=w> </span><span class=nb>@bitCast</span><span class=p>(</span><span class=n>std</span><span class=p>.</span><span class=n>time</span><span class=p>.</span><span class=nf>milliTimestamp</span><span class=p>())));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kr>const</span><span class=w> </span><span class=n>memo_rnd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>memoize</span><span class=p>(</span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>)(</span><span class=n>rand</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>defer</span><span class=w> </span><span class=n>memo_rnd</span><span class=p>.</span><span class=nf>deinit</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>testing</span><span class=p>.</span><span class=nf>expectEqual</span><span class=p>(</span><span class=n>rnd</span><span class=p>.</span><span class=nf>random</span><span class=p>().</span><span class=nf>int</span><span class=p>(</span><span class=kt>i32</span><span class=p>),</span><span class=w> </span><span class=n>memo_rnd</span><span class=p>.</span><span class=nf>call</span><span class=p>(</span><span class=mi>42</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></table></div></div><h2 id=la-fin>La Fin</h2><p>This is what I&rsquo;ve gotten up until now. Zig&rsquo;s syntax is ugly, and I&rsquo;m not
particularly excited about it&rsquo;s design philosophy but damn is it a solid
language. This little challenge has made me enjoy Zig a lot more than I thought.</section><footer><nav id=keywords aria-label=Tags><span>Tags:&nbsp;</span><ul class=delimiter role=presentation><li><a href=https://stau.space/tags/math/>Math</a><li><a href=https://stau.space/tags/category-theory/>Category Theory</a><li><a href=https://stau.space/tags/programming/>Programming</a><li><a href=https://stau.space/tags/computer-science/>Computer Science</a></ul></nav></footer></article><div id=exclude role=presentation><hr class=hide style="margin:1in 0"><div id=contentinfo class=pagewidth role=contentinfo data-pagefind-ignore=all><nav id=related aria-label="You might also like"><strong class=section-title>You might also like</strong><ol><li><a href=https://stau.space/posts/hare-rope/>Hare Rope</a><li><a href=https://stau.space/posts/cpp-prelude/>C++ Prelude</a><li><a href=https://stau.space/posts/mandelbrot/>Fractal Renderer</a><li><a href=https://stau.space/posts/icpc-regionals/>We Lost the ICPC Regionals</a><li><a href=https://stau.space/posts/rdbm/>R. O. N. DB Manager</a></ol></nav><div id=colophon style=display:none aria-live=polite><strong class=section-title>Colophon</strong><div><div id=qr role=img aria-label="QR code"></div><div class=verbose><div class=has-aria-label-top aria-label="Zig CTFP"><span>https://stau.space/posts/zig-ctfp/</span></div><div><span>This page is built on: </span><time datetime=2026-01-17T21:52:46-04:00>2026-01-17 21:52</time></div><div><span>This page is accessed on: </span><time id=time-stamp></time></div><div><span>Powered by </span><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <a href=https://github.com/gohugoio/hugo/releases/tag/v0.152.2 aria-label="Hugo 0.152.2" target=_blank rel=noopener>v0.152.2</a> & <a href=https://github.com/foxihd/hugo-brewm target=_blank rel=noopener>hugo-brewm</a>.</div></div></div></div><div id=has-timeline><strong class=section-title>Redaction History</strong><ol aria-label="Redaction History"><li><time datetime=2024-08-07T11:38:20-04:00>August 7, 2024</time>
<span>(Published)</span><li><time datetime=2025-12-06T20:01:13-04:00>December 6, 2025</time>
<span>(Modified)</span></ol><p>Some information might changes over time, we keep redaction up to date.</div><div id=contribute tabindex=0><strong class=section-title>Enjoy this article?</strong><br><span>Awesome!
Did you know that 4 cups of coffee helped us write this article?
You can also support me by making the following contributions:</span><details id=has-contrib-menu class=presentation open><summary class=hide aria-label=Contribute><span>Contribute</span></summary><nav id=contrib-menu aria-label=Contribute><ul class="l1 has-childfree" role=presentation tabindex=-1><li role=presentation><a href=https://github.com/sponsors/sona-tau rel=external noopener noreferrer nofollow target=_blank><i class="icon sri">githubsponsors</i>
<span>Become Github Sponsors</span></a></ul></nav></details></div></div><hr class=hide><footer id=main-footer><div class="column column--multicols pagewidth" style=--multicols:2><div id=main-footer-primary><p><strong>Cool stuff</strong><ul><li><a href=https://tangled.org/stau.space target=_blank rel="external noopener noreferrer nofollow">Git</a><li><a href=stau.space>ATProto</a></ul><br><fieldset><legend>Buttons</legend><div><img style=max-width:81px;height:auto src=https://stau.space/images/transrights.png alt="Trans rights NOW!">
<img style=max-width:81px;height:auto src=https://stau.space/images/brainmade.png alt=brainmade.org>
<img style=max-width:81px;height:auto src=https://stau.space/images/dontfeedai.gif alt="Don't feed the AI!"></div></fieldset></div><div id=main-footer-secondary class=column style=--col:10rem><div><p><strong>Cool stuff</strong><ul><li><a href=https://tangled.org/stau.space target=_blank rel="external noopener noreferrer nofollow">Git</a><li><a href=stau.space>ATProto</a></ul></div><div></div><nav id=menu-footer class=has-aria-label-top aria-label="Let's keep in touch!"><ul role=presentation><li><a href aria-label="0009 0000 6779 8166"><i class=icon>orcid</i>
<span class=t role=tooltip>0009 0000 6779 8166</span></a><li><a href aria-label=@sona-tau:matrix.org><i class=icon>xmark</i>
<span class=t role=tooltip>@sona-tau:matrix.org</span></a><li><a href aria-label=@stau.post><i class=icon>instagram</i>
<span class=t role=tooltip>@stau.post</span></a><li><a href aria-label=@stau.space><i class=icon>bluesky</i>
<span class=t role=tooltip>@stau.space</span></a><li><a href aria-label=@stau_space><i class=icon>twitter</i>
<span class=t role=tooltip>@stau_space</span></a><li><a href aria-label="RSS feed"><i class=icon>rss</i>
<span class=t role=tooltip>RSS feed</span></a><li><a href aria-label=sona-tau><i class=icon>github</i>
<span class=t role=tooltip>sona-tau</span></a><li><a href aria-label=sona.42><i class=icon>signal</i>
<span class=t role=tooltip>sona.42</span></a><li><a href aria-label=sona@stau.space><i class=icon>email</i>
<span class=t role=tooltip>sona@stau.space</span></a><li><a href aria-label=sunglow.><i class=icon>discord</i>
<span class=t role=tooltip>sunglow.</span></a></ul></nav></div></div></footer></div></main><footer id=body-footer class=pagewidth><div id=background-footer class="background hide" role=presentation aria-hidden=true></div><div id=focusMode></div><details id=has-a11y class="presentation js-details hide" name=on-deck aria-haspopup=true aria-labelledby=has-a11y-summary data-i18n-accessibility=Accessibility data-i18n-optimizesr="Screen Reader Optimization" data-i18n-optimizesrdesc="Optimize display and resources for screen reader users who navigate with a pointer device." data-i18n-colorsettings="Color Settings" data-i18n-darkmode="Dark Mode" data-i18n-light=Light data-i18n-dark=Dark data-i18n-contrast=Contrast data-i18n-lesscontrast=Low data-i18n-morecontrast=High data-i18n-defaultcontrast=Default data-i18n-colorpalette="Color Palette" data-i18n-defaultcolor=Default data-i18n-deuteranopia=Deuteranopia data-i18n-protanopia=Protanopia data-i18n-tritanopia=Tritanopia data-i18n-monochrome=Monochrome data-i18n-fontsize="Font Size" data-i18n-baselinestretch="Baseline Stretch" data-i18n-opendyslexic="Use OpenDyslexic Font" data-i18n-menucontrols="Accessibility Menu Controls" data-i18n-save=Save data-i18n-reset=Reset data-i18n-close=Close data-i18n-bionread="BionRead Mode" data-i18n-focusmode="Focus Mode" data-i18n-nolocalstorage="LocalStorage is not available in your browser. Settings won't be saved."></details><div id=useBionRead class=sri></div><nav aria-label=Bypass><a id=to-top class=srm href=#top title="To Content Top" accesskey=c aria-keyshortcuts=c aria-label="To Content Top"><span class="t srt">To Content Top</span>
<kbd class=key aria-hidden=true data-key=c></kbd></a></nav></footer><div id=bionReadSnapshot hidden></div><div id=background-body role=presentation aria-hidden=true></div></html>